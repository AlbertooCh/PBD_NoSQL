<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Dashboard MongoDB - An√°lisis de Solvencia</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .card-header { background-color: #00ed64; color: #001e2b; font-weight: bold; } /* Colores Mongo */
        .btn-mongo { background-color: #001e2b; color: white; }
    </style>
</head>
<body>

<div class="container mt-5">
    <div class="text-center mb-4">
        <h1>üçÉ MongoDB Atlas Dashboard</h1>
        <p class="lead">B√∫squeda Inteligente de Perfiles (Querying)</p>
    </div>

    <div class="row">
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-header">üîç Filtros de B√∫squeda</div>
                <div class="card-body">
                    <form id="filtroForm">
                        <div class="mb-3">
                            <label class="form-label">Sector Econ√≥mico</label>
                            <select class="form-select" id="sector">
                                <option value="todos">Todos los sectores</option>
                                <option value="1">Agricultura (ID 1)</option>
                                <option value="2">Industria (ID 2)</option>
                                <option value="3">Servicios (ID 3)</option>
                                <option value="4">Construcci√≥n (ID 4)</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Ingresos M√≠nimos (‚Ç¨)</label>
                            <input type="number" class="form-control" id="ingresos" value="20000">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">M√°x. Gasto en Ropa (‚Ç¨)</label>
                            <input type="number" class="form-control" id="ropa" value="5000">
                        </div>
                        <button type="submit" class="btn btn-mongo w-100">Buscar Candidatos</button>
                    </form>
                    <div class="alert alert-info mt-3" style="font-size: 0.8rem;">
                        <strong>Diferenciaci√≥n:</strong> Esta consulta filtra dentro del documento JSON en el servidor. Redis/Riak no pueden hacer esto nativamente sin descargar todos los datos.
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header">üìä Resultados en Tiempo Real</div>
                <div class="card-body">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Sector</th>
                                <th>Ingresos</th>
                                <th>Gasto Ropa</th>
                            </tr>
                        </thead>
                        <tbody id="tablaResultados">
                            </tbody>
                    </table>
                    <p id="contador" class="text-end text-muted">Esperando b√∫squeda...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('filtroForm').addEventListener('submit', async function(e) {
        e.preventDefault(); // Evita que la p√°gina se recargue

        // 1. Capturamos los datos del formulario
        const datos = {
            sector_id: document.getElementById('sector').value,
            min_ingresos: document.getElementById('ingresos').value,
            max_ropa: document.getElementById('ropa').value
        };

        // 2. Llamamos al Backend (Python/Flask)
        const response = await fetch('/api/buscar', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(datos)
        });

        const resultados = await response.json();

        // 3. Pintamos la tabla
        const tbody = document.getElementById('tablaResultados');
        tbody.innerHTML = ''; // Limpiar tabla

        resultados.forEach(usuario => {
            const fila = `
                <tr>
                    <td>${usuario.nombre} ${usuario.apellido1}</td>
                    <td>${usuario.sector_id}</td>
                    <td class="text-success fw-bold">${usuario.ingresos} ‚Ç¨</td>
                    <td class="text-danger">${usuario.gastosRopa} ‚Ç¨</td>
                </tr>
            `;
            tbody.innerHTML += fila;
        });

        document.getElementById('contador').innerText = `Encontrados: ${resultados.length} registros`;
    });
</script>

</body>
</html>